<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.hqy.cloud.message.tk.mapper.ImConversationMapper">

    <select id="queryGroupConversationMembers" resultType="com.hqy.cloud.message.tk.entity.ImConversation">
        SELECT id,user_id,contact_id
        FROM t_im_conversation
        WHERE contact_id = #{groupId} AND is_group = 1
    </select>

    <insert id="insertOrUpdate" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO t_im_conversation
        (
            user_id,
            contact_id,
            is_group,
            is_notice,
            is_top,
            last_message_from,
            last_message_type,
            last_message_content,
            last_message_time,
            created,
            updated
        ) VALUES
        <foreach collection="conversations" item="conversation" separator="," >
            (
             #{conversation.userId},
             #{conversation.contactId},
             #{conversation.group},
             #{conversation.notice},
             #{conversation.top},
             #{conversation.lastMessageFrom},
             #{conversation.lastMessageType},
             #{conversation.lastMessageContent},
             #{conversation.lastMessageTime},
             #{conversation.created},
             #{conversation.updated}
            )
        </foreach>
        ON DUPLICATE KEY UPDATE
        is_remove = VALUES(is_remove),
        last_message_from = VALUES(last_message_from),
        last_message_type = VALUES(last_message_type),
        last_message_content = VALUES(last_message_content),
        last_message_time = VALUES(last_message_time),
        updated = VALUES(updated)
    </insert>



</mapper>