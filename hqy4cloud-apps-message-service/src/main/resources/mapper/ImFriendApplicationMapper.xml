<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.hqy.cloud.message.tk.mapper.ImFriendApplicationMapper">


    <insert id="insertDuplicate">
        INSERT INTO t_im_friend_application
        (
         apply,
         receive,
         remark,
         status,
         created,
         updated
        ) VALUES
        (
         #{application.apply},
         #{application.receive},
         #{application.remark},
         #{application.status},
         #{application.created},
         #{application.updated}
        ) ON DUPLICATE KEY UPDATE
            remark = VALUES(remark),
            updated = VALUES(updated)
    </insert>
    <update id="updateApplicationStatus">
        UPDATE `t_im_friend_application` SET `status` = #{status}
        WHERE id IN
        <foreach collection="ids" close=")" open="(" item="id" separator=",">
            #{id}
        </foreach>
    </update>

    <select id="queryFriendApplications" resultType="com.hqy.cloud.message.tk.entity.ImFriendApplication">
        SELECT id, apply, receive,  remark, status, created
        FROM `t_im_friend_application`
        WHERE apply = #{userId} or receive = #{userId}
        ORDER BY created DESC
    </select>
    <select id="selectUnread" resultType="java.lang.Integer">
        SELECT count(*)
        FROM `t_im_friend_application` WHERE `receive` = #{receive} AND `status` IS NULL
    </select>


</mapper>